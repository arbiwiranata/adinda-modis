a:2:{i:0;a:3:{s:10:"sourceFile";s:55:"D:\laragon\www\adinda-modis\plansys\forms\LoginForm.php";s:4:"file";a:180:{i:0;s:5:"<?php";i:1;s:0:"";i:2;s:3:"/**";i:3;s:19:" * LoginForm class.";i:4;s:46:" * LoginForm is the data structure for keeping";i:5;s:78:" * user login form data. It is used by the 'login' action of 'SiteController'.";i:6;s:3:" */";i:7;s:28:"class LoginForm extends Form";i:8;s:1:"{";i:9;s:18:"	public $username;";i:10;s:18:"	public $password;";i:11;s:30:"    public $rememberMe = true;";i:12;s:0:"";i:13;s:20:"	private $_identity;";i:14;s:0:"";i:15;s:4:"	/**";i:16;s:34:"	 * Declares the validation rules.";i:17;s:60:"	 * The rules state that username and password are required,";i:18;s:43:"	 * and password needs to be authenticated.";i:19;s:4:"	 */";i:20;s:31:"    public function getForm() {";i:21;s:22:"        return array (";i:22;s:35:"            'title' => 'LoginForm',";i:23;s:31:"            'layout' => array (";i:24;s:39:"                'name' => 'full-width',";i:25;s:33:"                'data' => array (";i:26;s:37:"                    'col1' => array (";i:27;s:45:"                        'type' => 'mainform',";i:28;s:40:"                        'size' => '100',";i:29;s:22:"                    ),";i:30;s:18:"                ),";i:31;s:14:"            ),";i:32;s:32:"            'options' => array (";i:33;s:45:"                'class' => 'login-container',";i:34;s:14:"            ),";i:35;s:10:"        );";i:36;s:5:"    }";i:37;s:0:"";i:38;s:33:"    public function getFields() {";i:39;s:22:"        return array (";i:40;s:19:"            array (";i:41;s:33:"                'type' => 'Text',";i:42;s:54:"                'value' => '<div class=\"login form\">";i:43;s:2:"',";i:44;s:14:"            ),";i:45;s:19:"            array (";i:46;s:42:"                'renderInEditor' => 'Yes',";i:47;s:33:"                'type' => 'Text',";i:48;s:93:"                'value' => '<img src=\\"plansys/static/img/welcome.png\\" width=\\"100%\\">',";i:49;s:14:"            ),";i:50;s:19:"            array (";i:51;s:38:"                'label' => 'Username',";i:52;s:37:"                'name' => 'username',";i:53;s:39:"                'layout' => 'Vertical',";i:54;s:37:"                'fieldWidth' => '12',";i:55;s:38:"                'type' => 'TextField',";i:56;s:14:"            ),";i:57;s:19:"            array (";i:58;s:38:"                'label' => 'Password',";i:59;s:37:"                'name' => 'password',";i:60;s:42:"                'fieldType' => 'password',";i:61;s:39:"                'layout' => 'Vertical',";i:62;s:37:"                'fieldWidth' => '12',";i:63;s:38:"                'type' => 'TextField',";i:64;s:14:"            ),";i:65;s:19:"            array (";i:66;s:33:"                'type' => 'Text',";i:67;s:121:"                'value' => '<label style=\"display:none;float:right;margin-top:17px;font-weight:normal;font-size:12px;\">";i:68;s:75:"<input type=\"checkbox\" name=\"LoginForm[rememberMe]\" /> Remember Me<br/>";i:69;s:0:"";i:70;s:74:"<div style=\"margin-left:17px;font-size:10px;color:#999;\">(30 Days)</div>";i:71;s:10:"</label>',";i:72;s:14:"            ),";i:73;s:19:"            array (";i:74;s:36:"                'label' => 'Submit',";i:75;s:42:"                'buttonType' => 'success',";i:76;s:35:"                'buttonSize' => '',";i:77;s:43:"                'buttonPosition' => 'left',";i:78;s:36:"                'options' => array (";i:79;s:43:"                    'class' => 'btn-block',";i:80;s:18:"                ),";i:81;s:41:"                'type' => 'SubmitButton',";i:82;s:14:"            ),";i:83;s:19:"            array (";i:84;s:33:"                'type' => 'Text',";i:85;s:36:"                'value' => '</div>',";i:86;s:14:"            ),";i:87;s:10:"        );";i:88;s:5:"    }";i:89;s:0:"";i:90;s:24:"	public function rules()";i:91;s:2:"	{";i:92;s:15:"		return array(";i:93;s:40:"			// username and password are required";i:94;s:43:"			array('username, password', 'required'),";i:95;s:40:"			// password needs to be authenticated";i:96;s:37:"			array('password', 'authenticate'),";i:97;s:4:"		);";i:98;s:2:"	}";i:99;s:0:"";i:100;s:4:"	/**";i:101;s:31:"	 * Authenticates the password.";i:102;s:64:"	 * This is the 'authenticate' validator as declared in rules().";i:103;s:4:"	 */";i:104;s:49:"	public function authenticate($attribute,$params)";i:105;s:2:"	{";i:106;s:25:"		if(!$this->hasErrors())";i:107;s:3:"		{";i:108;s:70:"			$this->_identity=new UserIdentity($this->username,$this->password);";i:109;s:41:"			if(!$this->_identity->authenticate()){";i:110;s:40:"			 //   if(!$this->authenticateHris()){";i:111;s:73:"			        $this->addError('password','Incorrect username or password.');";i:112;s:10:"			 //   }";i:113;s:4:"			}";i:114;s:9:"        }";i:115;s:2:"	}";i:116;s:0:"";i:117;s:40:"    public function authenticateHris() {";i:118;s:87:"        $record = HrisUser::model()->findByAttributes(['username' => $this->username]);";i:119;s:8:"        ";i:120;s:25:"        $user = new User;";i:121;s:48:"        $user->attributes = $record->attributes;";i:122;s:22:"        $user->save();";i:123;s:8:"        ";i:124;s:34:"        $user_role = new UserRole;";i:125;s:42:"        $user_role->user_id = $record->id;";i:126;s:32:"        $user_role->role_id = 4;";i:127;s:44:"        $user_role->is_default_role = "Yes";";i:128;s:27:"        $user_role->save();";i:129;s:28:"        // $useLdap = false;";i:130;s:91:"        // if (!is_null($record) && $record->password == '' && Yii::app()->user->useLdap) {";i:131;s:31:"        //     $useLdap = true;";i:132;s:95:"        //     $ldapSuccess = Yii::app()->ldap->authenticate($this->username, $this->password);";i:133;s:34:"        //     if ($ldapSuccess) {";i:134;s:44:"        //         $this->loggedIn($record);";i:135;s:31:"        //         return true;";i:136;s:16:"        //     }";i:137;s:12:"        // }";i:138;s:0:"";i:139;s:34:"        // if ($record === null) {";i:140;s:63:"        //     $this->errorCode = self::ERROR_USERNAME_INVALID;";i:141;s:12:"        // }";i:142;s:75:"        // else if (!password_verify($this->password, $record->password)) {";i:143;s:30:"        //     if ($useLdap) {";i:144;s:99:"        //         $ldapSuccess = Yii::app()->ldap->authenticate($this->username, $this->password);";i:145;s:38:"        //         if ($ldapSuccess) {";i:146;s:48:"        //             $this->loggedIn($record);";i:147;s:35:"        //             return true;";i:148;s:27:"        //         } else {";i:149;s:71:"        //             $this->errorCode = self::ERROR_PASSWORD_INVALID;";i:150;s:20:"        //         }";i:151;s:23:"        //     } else {";i:152;s:67:"        //         $this->errorCode = self::ERROR_PASSWORD_INVALID;";i:153;s:16:"        //     }";i:154;s:19:"        // } else {";i:155;s:40:"        //     $this->loggedIn($record);";i:156;s:12:"        // }";i:157;s:36:"        // return !$this->errorCode;";i:158;s:5:"    }";i:159;s:4:"	/**";i:160;s:72:"	 * Logs in the user using the given username and password in the model.";i:161;s:47:"	 * @return boolean whether login is successful";i:162;s:4:"	 */";i:163;s:24:"	public function login()";i:164;s:2:"	{";i:165;s:29:"		if($this->_identity===null)";i:166;s:3:"		{";i:167;s:70:"			$this->_identity=new UserIdentity($this->username,$this->password);";i:168;s:36:"			$this->_identity->authenticate();";i:169;s:9:"        }";i:170;s:60:"		if($this->_identity->errorCode===UserIdentity::ERROR_NONE)";i:171;s:3:"		{";i:172;s:59:"			$duration=$this->rememberMe ? 3600*24*30 : 0; // 30 days";i:173;s:64:"            Yii::app()->user->login($this->_identity,$duration);";i:174;s:15:"			return true;";i:175;s:3:"		}";i:176;s:6:"		else";i:177;s:16:"			return false;";i:178;s:2:"	}";i:179;s:1:"}";}s:7:"methods";a:6:{s:7:"getForm";a:2:{s:4:"line";i:20;s:6:"length";i:17;}s:9:"getFields";a:2:{s:4:"line";i:38;s:6:"length";i:51;}s:5:"rules";a:2:{s:4:"line";i:90;s:6:"length";i:9;}s:12:"authenticate";a:2:{s:4:"line";i:104;s:6:"length";i:12;}s:16:"authenticateHris";a:2:{s:4:"line";i:117;s:6:"length";i:42;}s:5:"login";a:2:{s:4:"line";i:163;s:6:"length";i:16;}}}i:1;N;}